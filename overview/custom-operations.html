
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', 'G-F9LD9HL8LW', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>Extending Kompute with Custom C++ Operations &#8212; Vulkan Kompute Documentation (Python &amp; C++)</title>
    <link rel="stylesheet" href="../_static/material.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/assets/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Class Documentation and C++ Reference" href="reference.html" />
    <link rel="prev" title="Converting Shaders to C++ Headers" href="shaders-to-headers.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=red data-md-color-accent=light-blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#overview/custom-operations" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Vulkan Kompute Documentation (Python &amp; C++)"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Vulkan Kompute Documentation (Python & C++)</span>
          <span class="md-header-nav__topic"> Extending Kompute with Custom C++ Operations </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/EthicalML/vulkan-kompute/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Vulkan Kompute
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Vulkan Kompute Documentation (Python & C++)</a></li>
            
            <li class="md-tabs__item"><a href="https://github.com/EthicalML/vulkan-kompute/" class="md-tabs__link">Kompute Repo</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Vulkan Kompute Documentation (Python &amp; C++)" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Vulkan Kompute Documentation (Python &amp; C++)">Vulkan Kompute Documentation (Python & C++)</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/EthicalML/vulkan-kompute/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Vulkan Kompute
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="https://kompute.cc/" class="md-nav__link">Documentation Home</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">C++ Documentation:</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="advanced-examples.html" class="md-nav__link">C++ Examples</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="memory-management.html" class="md-nav__link">C++ Memory Management Principles</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="build-system.html" class="md-nav__link">C++ Build System Deep Dive</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="shaders-to-headers.html" class="md-nav__link">C++ Converting GLSL/HLSL Shaders to Cpp Headers</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> C++ Extending Kompute with Custom Operations </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">C++ Extending Kompute with Custom Operations</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#overview-custom-operations--page-root" class="md-nav__link">Extending Kompute with Custom C++ Operations</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#flow-of-function-calls" class="md-nav__link">Flow of Function Calls</a>
        </li>
        <li class="md-nav__item"><a href="#simple-operation-extending-opalgobase" class="md-nav__link">Simple Operation Extending OpAlgoBase</a>
        </li>
        <li class="md-nav__item"><a href="#more-complex-operation-extending-opalgobase" class="md-nav__link">More Complex Operation Extending OpAlgoBase</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#then-the-implementation-outlines-all-the-implementations-that-perform-the-actions-above" class="md-nav__link">Then the implementation outlines all the implementations that perform the actions above:</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/overview/custom-operations.rst.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="reference.html" class="md-nav__link">C++ Class Documentation & Reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="https://kompute.cc/codecov/" class="md-nav__link">C++ Code Coverage</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Python Documentation:</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="python-package.html" class="md-nav__link">Python Package Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="python-examples.html" class="md-nav__link">Python Examples</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="python-reference.html" class="md-nav__link">Python Class Documentation & Reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Concepts &amp; Deep Dives:</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ci-tests.html" class="md-nav__link">CI, Docker Images Docs & Tests</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="async-parallel.html" class="md-nav__link">Asynchronous & Parallel Operations</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mobile-android.html" class="md-nav__link">Mobile App Integration (Android)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="game-engine-godot.html" class="md-nav__link">Game Engine Integration (Godot Engine)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../genindex.html" class="md-nav__link">Code Index</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#overview-custom-operations--page-root" class="md-nav__link">Extending Kompute with Custom C++ Operations</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#flow-of-function-calls" class="md-nav__link">Flow of Function Calls</a>
        </li>
        <li class="md-nav__item"><a href="#simple-operation-extending-opalgobase" class="md-nav__link">Simple Operation Extending OpAlgoBase</a>
        </li>
        <li class="md-nav__item"><a href="#more-complex-operation-extending-opalgobase" class="md-nav__link">More Complex Operation Extending OpAlgoBase</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#then-the-implementation-outlines-all-the-implementations-that-perform-the-actions-above" class="md-nav__link">Then the implementation outlines all the implementations that perform the actions above:</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/overview/custom-operations.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="overview-custom-operations--page-root">Extending Kompute with Custom C++ Operations<a class="headerlink" href="#overview-custom-operations--page-root" title="Permalink to this headline">¶</a></h1>
<p>Kompute provides an extenisble architecture which allows for the core components to be extended by building custom operations.</p>
<p>Building operations is intuitive however it requires knowing some nuances around the order in which each of the class functions across the operation are called as a sequence is executed.</p>
<p>These nuances are important for more advanced users of Kompute, as this will provide further intuition in what are the specific functions and components that the native functions (like OpTensorCreate, OpAlgoBase, etc) contain which define their specific behaviour.</p>

<h2 id="flow-of-function-calls">Flow of Function Calls<a class="headerlink" href="#flow-of-function-calls" title="Permalink to this headline">¶</a></h2>
<p>The top level operation which all operations inherit from is the <cite>kp::OpBase</cite> class. Some of the “Core Native Operations” like <cite>kp::OpTensorCopy</cite>, <cite>kp::OpTensorCreate</cite>, etc all inherit from the base operation class.</p>
<p>The <cite>kp::OpAlgoBase</cite> is another base operation that is specifically built to enable users to create their own operations that contain custom shader logic (i.e. requiring Vulkan Compute Pipelines, DescriptorSets, etc). The next section contains an example which shows how to extend the OpAlgoBase class.</p>
<p>Below you</p>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>OpBase(…, tensors, freeTensors)</p></td>
<td><p>Constructor for class where you can load/define resources such as shaders, etc.</p></td>
</tr>
<tr class="row-odd"><td><p>~OpBase()</p></td>
<td><p>Destructor that frees vulkan resources (if owned) which should be used to manage any memory allocations created through the operation.</p></td>
</tr>
<tr class="row-even"><td><p>init()</p></td>
<td><p>Init function gets called in the Sequence / Manager inside the record step. This function allows for relevant objects to be initialised within the operation.</p></td>
</tr>
<tr class="row-odd"><td><p>record()</p></td>
<td><p>Record function that gets called in the Sequence / Manager inside the record step after init(). In this function you can directly record to the Vulkan command buffer.</p></td>
</tr>
<tr class="row-even"><td><p>preEval()</p></td>
<td><p>When the Sequence is Evaluated this preEval is called across all operations before dispatching the batch of recorded commands to the GPU. This is useful for example if you need to copy data from local to host memory.</p></td>
</tr>
<tr class="row-odd"><td><p>postEval()</p></td>
<td><p>After the sequence is Evaluated this postEval is called across all operations. When running asynchronously the postEval is called when you call <cite>evalAwait()</cite>, which is why it’s important to always run evalAwait() to ensure the process doesn’t go into inconsistent state.</p></td>
</tr>
</tbody>
</table>


<h2 id="simple-operation-extending-opalgobase">Simple Operation Extending OpAlgoBase<a class="headerlink" href="#simple-operation-extending-opalgobase" title="Permalink to this headline">¶</a></h2>
<p>Below we show a very simple example that enables you to create an operation with a pre-specified shader. In this case it is the multiplication shader.</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OpMyCustom</span> <span class="o">:</span> <span class="k">public</span> <span class="n">OpAlgoBase</span>
<span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="n">OpMyCustom</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vk</span><span class="o">::</span><span class="n">PhysicalDevice</span><span class="o">&gt;</span> <span class="n">physicalDevice</span><span class="p">,</span>
           <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vk</span><span class="o">::</span><span class="n">Device</span><span class="o">&gt;</span> <span class="n">device</span><span class="p">,</span>
           <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vk</span><span class="o">::</span><span class="n">CommandBuffer</span><span class="o">&gt;</span> <span class="n">commandBuffer</span><span class="p">,</span>
           <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&gt;&gt;</span> <span class="n">tensors</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">OpAlgoBase</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">commandBuffer</span><span class="p">,</span> <span class="n">tensors</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Perform your custom steps such as reading from a shader file</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">mShaderFilePath</span> <span class="o">=</span> <span class="s">"shaders/glsl/opmult.comp"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">kp</span><span class="o">::</span><span class="n">Manager</span> <span class="n">mgr</span><span class="p">;</span> <span class="c1">// Automatically selects Device 0</span>

    <span class="c1">// Create 3 tensors of default type float</span>
    <span class="k">auto</span> <span class="n">tensorLhs</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">kp</span><span class="o">::</span><span class="n">Tensor</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kp</span><span class="o">::</span><span class="n">Tensor</span><span class="p">({</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span> <span class="p">}));</span>
    <span class="k">auto</span> <span class="n">tensorRhs</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">kp</span><span class="o">::</span><span class="n">Tensor</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kp</span><span class="o">::</span><span class="n">Tensor</span><span class="p">({</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">6.</span> <span class="p">}));</span>
    <span class="k">auto</span> <span class="n">tensorOut</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">kp</span><span class="o">::</span><span class="n">Tensor</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kp</span><span class="o">::</span><span class="n">Tensor</span><span class="p">({</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span> <span class="p">}));</span>

    <span class="c1">// Create tensors data explicitly in GPU with an operation</span>
    <span class="n">mgr</span><span class="p">.</span><span class="n">evalOpDefault</span><span class="o">&lt;</span><span class="n">kp</span><span class="o">::</span><span class="n">OpTensorCreate</span><span class="o">&gt;</span><span class="p">({</span> <span class="n">tensorLhs</span><span class="p">,</span> <span class="n">tensorRhs</span><span class="p">,</span> <span class="n">tensorOut</span> <span class="p">});</span>

    <span class="c1">// Run Kompute operation on the parameters provided with dispatch layout</span>
    <span class="n">mgr</span><span class="p">.</span><span class="n">evalOpDefault</span><span class="o">&lt;</span><span class="n">kp</span><span class="o">::</span><span class="n">OpMyCustom</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="p">{</span> <span class="n">tensorLhs</span><span class="p">,</span> <span class="n">tensorRhs</span><span class="p">,</span> <span class="n">tensorOut</span> <span class="p">});</span>

    <span class="c1">// Prints the output which is { 0, 4, 12 }</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">fmt</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">"Output: {}"</span><span class="p">,</span> <span class="n">tensorOutput</span><span class="p">.</span><span class="n">data</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>


<h2 id="more-complex-operation-extending-opalgobase">More Complex Operation Extending OpAlgoBase<a class="headerlink" href="#more-complex-operation-extending-opalgobase" title="Permalink to this headline">¶</a></h2>
<p>Below we show a more complex operation that performs the following:</p>
<ul class="simple">
<li><p>Expects three tensors for an operation, two inputs and one output</p></li>
<li><p>Expects the tensors to be initialised</p></li>
<li><p>Checks that the tensors are of the same size</p></li>
<li><p>Expects output tensor to be of type TensorTypes::eDevice (and creates staging tensor)</p></li>
<li><p>Has functionality to read shader from file or directly from spirv bytes</p></li>
<li><p>Records relevant bufferMemoryBarriers</p></li>
<li><p>Records dispatch command</p></li>
<li><p>Records copy command from device tensor to staging output tensor</p></li>
<li><p>In postEval it maps data from staging tensor to output tensor’s data</p></li>
</ul>
<p>For starters, the header file contains the functions that will be overriden:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">"kompute/Core.hpp"</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">"kompute/Algorithm.hpp"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"kompute/Tensor.hpp"</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">"kompute/operations/OpAlgoBase.hpp"</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">kp</span> <span class="p">{</span>

<span class="cm">/**</span>
<span class="cm"> * Operation base class to simplify the creation of operations that require</span>
<span class="cm"> * right hand and left hand side datapoints together with a single output.</span>
<span class="cm"> * The expected data passed is two input tensors and one output tensor.</span>
<span class="cm"> */</span>
<span class="k">class</span> <span class="nc">OpAlgoLhsRhsOut</span> <span class="o">:</span> <span class="k">public</span> <span class="n">OpAlgoBase</span>
<span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="cm">/**</span>
<span class="cm">     *  Base constructor, should not be used unless explicitly intended.</span>
<span class="cm">     */</span>
    <span class="n">OpAlgoLhsRhsOut</span><span class="p">();</span>

    <span class="cm">/**</span>
<span class="cm">     * Default constructor with parameters that provides the bare minimum</span>
<span class="cm">     * requirements for the operations to be able to create and manage their</span>
<span class="cm">     * sub-components.</span>
<span class="cm">     *</span>
<span class="cm">     * @param physicalDevice Vulkan physical device used to find device queues</span>
<span class="cm">     * @param device Vulkan logical device for passing to Algorithm</span>
<span class="cm">     * @param commandBuffer Vulkan Command Buffer to record commands into</span>
<span class="cm">     * @param tensors Tensors that are to be used in this operation</span>
<span class="cm">     * @param freeTensors Whether operation manages the memory of the Tensors</span>
<span class="cm">     * @param komputeWorkgroup Optional parameter to specify the layout for processing</span>
<span class="cm">     */</span>
    <span class="n">OpAlgoLhsRhsOut</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vk</span><span class="o">::</span><span class="n">PhysicalDevice</span><span class="o">&gt;</span> <span class="n">physicalDevice</span><span class="p">,</span>
           <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vk</span><span class="o">::</span><span class="n">Device</span><span class="o">&gt;</span> <span class="n">device</span><span class="p">,</span>
           <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vk</span><span class="o">::</span><span class="n">CommandBuffer</span><span class="o">&gt;</span> <span class="n">commandBuffer</span><span class="p">,</span>
           <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&gt;&gt;</span> <span class="n">tensors</span><span class="p">,</span>
           <span class="k">const</span> <span class="n">Workgroup</span><span class="o">&amp;</span> <span class="n">komputeWorkgroup</span> <span class="o">=</span> <span class="p">{});</span>

    <span class="cm">/**</span>
<span class="cm">     * Default destructor, which is in charge of destroying the algorithm</span>
<span class="cm">     * components but does not destroy the underlying tensors</span>
<span class="cm">     */</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">OpAlgoLhsRhsOut</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * The init function is responsible for ensuring that all of the tensors</span>
<span class="cm">     * provided are aligned with requirements such as LHS, RHS and Output</span>
<span class="cm">     * tensors, and  creates the algorithm component which processes the</span>
<span class="cm">     * computation.</span>
<span class="cm">     */</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">init</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * This records the commands that are to be sent to the GPU. This includes</span>
<span class="cm">     * the barriers that ensure the memory has been copied before going in and</span>
<span class="cm">     * out of the shader, as well as the dispatch operation that sends the</span>
<span class="cm">     * shader processing to the gpu. This function also records the GPU memory</span>
<span class="cm">     * copy of the output data for the staging buffer so it can be read by the</span>
<span class="cm">     * host.</span>
<span class="cm">     */</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">record</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Executes after the recorded commands are submitted, and performs a copy</span>
<span class="cm">     * of the GPU Device memory into the staging buffer so the output data can</span>
<span class="cm">     * be retrieved.</span>
<span class="cm">     */</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">postEval</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>

  <span class="k">protected</span><span class="o">:</span>
    <span class="c1">// -------------- NEVER OWNED RESOURCES</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&gt;</span> <span class="n">mTensorLHS</span><span class="p">;</span> <span class="c1">///&lt; Reference to the parameter used in the left hand side equation of the shader</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&gt;</span> <span class="n">mTensorRHS</span><span class="p">;</span> <span class="c1">///&lt; Reference to the parameter used in the right hand side equation of the shader</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&gt;</span> <span class="n">mTensorOutput</span><span class="p">;</span> <span class="c1">///&lt; Reference to the parameter used in the output of the shader and will be copied with a staging vector</span>
<span class="p">};</span>

<span class="p">}</span> <span class="c1">// End namespace kp</span>
</pre></div>
</div>

<h3 id="then-the-implementation-outlines-all-the-implementations-that-perform-the-actions-above">Then the implementation outlines all the implementations that perform the actions above:<a class="headerlink" href="#then-the-implementation-outlines-all-the-implementations-that-perform-the-actions-above" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#include</span> <span class="cpf">"kompute/operations/OpAlgoLhsRhsOut.hpp"</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">kp</span> <span class="p">{</span>

<span class="n">OpAlgoLhsRhsOut</span><span class="o">::</span><span class="n">OpAlgoLhsRhsOut</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SPDLOG_DEBUG</span><span class="p">(</span><span class="s">"Kompute OpAlgoLhsRhsOut constructor base"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">OpAlgoLhsRhsOut</span><span class="o">::</span><span class="n">OpAlgoLhsRhsOut</span><span class="p">(</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vk</span><span class="o">::</span><span class="n">PhysicalDevice</span><span class="o">&gt;</span> <span class="n">physicalDevice</span><span class="p">,</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vk</span><span class="o">::</span><span class="n">Device</span><span class="o">&gt;</span> <span class="n">device</span><span class="p">,</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vk</span><span class="o">::</span><span class="n">CommandBuffer</span><span class="o">&gt;</span> <span class="n">commandBuffer</span><span class="p">,</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&gt;&gt;</span> <span class="n">tensors</span><span class="p">,</span>
  <span class="k">const</span> <span class="n">Workgroup</span><span class="o">&amp;</span> <span class="n">komputeWorkgroup</span><span class="p">)</span>
  <span class="c1">// The inheritance is initialised with the copyOutputData to false given that</span>
  <span class="c1">// this depencendant class handles the transfer of data via staging buffers in</span>
  <span class="c1">// a granular way.</span>
  <span class="o">:</span> <span class="n">OpAlgoBase</span><span class="p">(</span><span class="n">physicalDevice</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">commandBuffer</span><span class="p">,</span> <span class="n">tensors</span><span class="p">,</span> <span class="n">komputeWorkgroup</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SPDLOG_DEBUG</span><span class="p">(</span><span class="s">"Kompute OpAlgoLhsRhsOut constructor with params"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">OpAlgoLhsRhsOut</span><span class="o">::~</span><span class="n">OpAlgoLhsRhsOut</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SPDLOG_DEBUG</span><span class="p">(</span><span class="s">"Kompute OpAlgoLhsRhsOut destructor started"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">OpAlgoLhsRhsOut</span><span class="o">::</span><span class="n">init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SPDLOG_DEBUG</span><span class="p">(</span><span class="s">"Kompute OpAlgoLhsRhsOut init called"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensors</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
          <span class="s">"Kompute OpAlgoLhsRhsOut called with less than 1 tensor"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensors</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SPDLOG_WARN</span><span class="p">(</span>
          <span class="s">"Kompute OpAlgoLhsRhsOut called with more than 3 this-&gt;mTensors"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorLHS</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensors</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorRHS</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensors</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorOutput</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensors</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorLHS</span><span class="o">-&gt;</span><span class="n">isInit</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorRHS</span><span class="o">-&gt;</span><span class="n">isInit</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
          <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorOutput</span><span class="o">-&gt;</span><span class="n">isInit</span><span class="p">()))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
          <span class="s">"Kompute OpAlgoLhsRhsOut all tensor parameters must be initialised. "</span>
          <span class="s">"LHS: "</span> <span class="o">+</span>
          <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorLHS</span><span class="o">-&gt;</span><span class="n">isInit</span><span class="p">())</span> <span class="o">+</span>
          <span class="s">" RHS: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorRHS</span><span class="o">-&gt;</span><span class="n">isInit</span><span class="p">())</span> <span class="o">+</span>
          <span class="s">" Output: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorOutput</span><span class="o">-&gt;</span><span class="n">isInit</span><span class="p">()));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorLHS</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorRHS</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
          <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorRHS</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorOutput</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
          <span class="s">"Kompute OpAlgoLhsRhsOut all tensor parameters must be the same size "</span>
          <span class="s">"LHS: "</span> <span class="o">+</span>
          <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorLHS</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span> <span class="o">+</span>
          <span class="s">" RHS: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorRHS</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span> <span class="o">+</span>
          <span class="s">" Output: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorOutput</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()));</span>
    <span class="p">}</span>

    <span class="n">SPDLOG_DEBUG</span><span class="p">(</span><span class="s">"Kompute OpAlgoLhsRhsOut fetching spirv data"</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span> <span class="n">shaderFileData</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">fetchSpirvBinaryData</span><span class="p">();</span>

    <span class="n">SPDLOG_DEBUG</span><span class="p">(</span><span class="s">"Kompute OpAlgoLhsRhsOut Initialising algorithm component"</span><span class="p">);</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">mAlgorithm</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="n">shaderFileData</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensors</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">OpAlgoLhsRhsOut</span><span class="o">::</span><span class="n">record</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SPDLOG_DEBUG</span><span class="p">(</span><span class="s">"Kompute OpAlgoLhsRhsOut record called"</span><span class="p">);</span>

    <span class="c1">// Barrier to ensure the data is finished writing to buffer memory</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorLHS</span><span class="o">-&gt;</span><span class="n">recordBufferMemoryBarrier</span><span class="p">(</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mCommandBuffer</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">AccessFlagBits</span><span class="o">::</span><span class="n">eHostWrite</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">AccessFlagBits</span><span class="o">::</span><span class="n">eShaderRead</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">PipelineStageFlagBits</span><span class="o">::</span><span class="n">eHost</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">PipelineStageFlagBits</span><span class="o">::</span><span class="n">eComputeShader</span><span class="p">);</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorRHS</span><span class="o">-&gt;</span><span class="n">recordBufferMemoryBarrier</span><span class="p">(</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mCommandBuffer</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">AccessFlagBits</span><span class="o">::</span><span class="n">eHostWrite</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">AccessFlagBits</span><span class="o">::</span><span class="n">eShaderRead</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">PipelineStageFlagBits</span><span class="o">::</span><span class="n">eHost</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">PipelineStageFlagBits</span><span class="o">::</span><span class="n">eComputeShader</span><span class="p">);</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">mAlgorithm</span><span class="o">-&gt;</span><span class="n">recordDispatch</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mKomputeWorkgroup</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="k">this</span><span class="o">-&gt;</span><span class="n">mKomputeWorkgroup</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="k">this</span><span class="o">-&gt;</span><span class="n">mKomputeWorkgroup</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="c1">// Barrier to ensure the shader code is executed before buffer read</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorOutput</span><span class="o">-&gt;</span><span class="n">recordBufferMemoryBarrier</span><span class="p">(</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mCommandBuffer</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">AccessFlagBits</span><span class="o">::</span><span class="n">eShaderWrite</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">AccessFlagBits</span><span class="o">::</span><span class="n">eTransferRead</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">PipelineStageFlagBits</span><span class="o">::</span><span class="n">eComputeShader</span><span class="p">,</span>
      <span class="n">vk</span><span class="o">::</span><span class="n">PipelineStageFlagBits</span><span class="o">::</span><span class="n">eTransfer</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorOutput</span><span class="o">-&gt;</span><span class="n">tensorType</span><span class="p">()</span> <span class="o">==</span> <span class="n">Tensor</span><span class="o">::</span><span class="n">TensorTypes</span><span class="o">::</span><span class="n">eDevice</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorOutput</span><span class="o">-&gt;</span><span class="n">recordCopyFromDeviceToStaging</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">mCommandBuffer</span><span class="p">,</span>
                                                           <span class="nb">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">OpAlgoLhsRhsOut</span><span class="o">::</span><span class="n">postEval</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SPDLOG_DEBUG</span><span class="p">(</span><span class="s">"Kompute OpAlgoLhsRhsOut postSubmit called"</span><span class="p">);</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">mTensorOutput</span><span class="o">-&gt;</span><span class="n">mapDataFromHostMemory</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>





          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="shaders-to-headers.html" title="Converting Shaders to C++ Headers"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Converting Shaders to C++ Headers </span>
              </div>
            </a>
          
          
            <a href="reference.html" title="Class Documentation and C++ Reference"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Class Documentation and C++ Reference </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2020, The Institute for Ethical AI &amp; Machine Learning.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>